<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>AUC 和 ROC</title>
	<meta name="description" content="">
	<meta name="generator" content="Hugo 0.40.2" />
	<meta property="og:title" content="AUC 和 ROC" />
<meta property="og:description" content="AUC 是点击率预估模型的常用评价指标，一般来说，AUC 越高，点击率模型越好，当然这也不是绝对的。虽然平时用 AUC 挺多的，但是一直没有深入去研究清楚，导致前几天被人问起的时候基本没答上来，很是忏愧。
AUC 其实是 Area Under Curve，然后这个 Curve 就是 ROC，全称是 Receiver Operating Characteristic，通常又叫做 ROC Curve。AUC 其实就是这个曲线下的面积了。AUC 有一个很重要的统计特性：AUC 值等于分类器对随机选择的正样本的预测值高于对随机选择的负样本的预测值的概率。AUC 的详细介绍和分析可以看这篇论文：An introduction to ROC analysis.
在说 ROC 之前，先说一下二值分类器的一些常用术语。如下所示，左边是模型预测的结果，上面是实际的分类情况。
    True Class 1 0     Prediction 1 TP FP    0 FN TN    来看下图，ROC 的横轴是 FPR (False Positive Rate)，纵轴是 TPR (True Positive Rate)，它们的定义分别如下：
$$ FPR = \frac{FP}{FP &#43; TN}$$ $$ TPR = \frac{TP}{TP&#43;FN} $$ 不妨来看图中的 4 个顶点：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://m.l2d.xyz/p/2016/auc-roc/" />



<meta property="article:published_time" content="2016-03-28T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2016-03-28T00:00:00&#43;00:00"/>











	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<script type="text/javascript" src="/js/scripts.js"></script>
	<link rel="shortcut icon" href="/favicon.ico">
	
</head>
<body class="body body-right-sidebar">
	<div class="container container-outer">
		<header class="header">
			<div class="container container-inner">
				<div class="logo" role="banner">
					<a class="logo__link" href="/" title="思考、记录" rel="home">
						<div class="logo__title">思考、记录</div>
						
					</a>
				</div>
			</div>
			
<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item"><a class="menu__link" href="/about/">ABOUT</a></li>
		<li class="menu__item menu__item--active"><a class="menu__link" href="/post/">POSTS</a></li>
	</ul>
</nav>

		</header>
		<div class="wrapper clearfix">

<main class="main content">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AUC 和 ROC</h1><div class="post__meta meta">
<svg class="icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
<time class="post__meta-date meta-date" datetime="2016-03-28T00:00:00">2016-03-28</time>
<span class="post__meta-categories meta-categories">
	<svg class="icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta-categories__list"><a class="meta-categories__link" href="/categories/rd" rel="category">rd</a></span>
</span></div>
		</header>
		<div class="post__content clearfix">
			

<p>AUC 是点击率预估模型的常用评价指标，一般来说，AUC 越高，点击率模型越好，当然这也不是绝对的。虽然平时用 AUC 挺多的，但是一直没有深入去研究清楚，导致前几天被人问起的时候基本没答上来，很是忏愧。</p>

<p>AUC 其实是 Area Under Curve，然后这个 Curve 就是 ROC，全称是 <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">Receiver Operating Characteristic</a>，通常又叫做 ROC Curve。AUC 其实就是这个曲线下的面积了。AUC 有一个很重要的统计特性：AUC 值等于分类器对随机选择的正样本的预测值高于对随机选择的负样本的预测值的概率。AUC 的详细介绍和分析可以看这篇论文：<a href="https://ccrma.stanford.edu/workshops/mir2009/references/ROCintro.pdf">An introduction to ROC analysis</a>.</p>

<p>在说 ROC 之前，先说一下二值分类器的一些常用术语。如下所示，左边是模型预测的结果，上面是实际的分类情况。</p>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">True Class</th>
<th align="center">1</th>
<th align="center">0</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"><strong>Prediction</strong></td>
<td align="center"><strong>1</strong></td>
<td align="center">TP</td>
<td align="center">FP</td>
</tr>

<tr>
<td align="center"></td>
<td align="center"><strong>0</strong></td>
<td align="center">FN</td>
<td align="center">TN</td>
</tr>
</tbody>
</table>

<p>来看下图，ROC 的横轴是 FPR (False Positive Rate)，纵轴是 TPR (True Positive Rate)，它们的定义分别如下：</p>

<div>$$ FPR = \frac{FP}{FP + TN}$$
$$ TPR = \frac{TP}{TP+FN} $$</div>

<p><img src="/img/roc.png"/></p>

<p>不妨来看图中的 4 个顶点：</p>

<ol>
<li>(0, 0): <code>$ TP = FP = 0 $</code>，模型将所有样本都预测为负</li>
<li>(0, 1): <code>$ FN = FP = 0 $</code>，模型对所有样本的预测都正确</li>
<li>(1, 1): <code>$ FN = TN = 0 $</code>，模型将所有样本都预测为正</li>
<li>(1, 0): <code>$ TP = TN = 0 $</code>，模型对所有样本的预测都错误</li>
</ol>

<p>ROC 曲线是这样画出来的：</p>

<ol>
<li>对模型预测的输出（属于正样本的概率）按从大到小排序。</li>
<li>从高到底，依次以当前预测值作为 <code>threshold</code>，大于则预测为正，否则为负。每次都可以得到一组不同的 FPR 和 TPR，也即 ROC 曲线上的一点。</li>
<li>将所有的点连接起来。 当 <code>threshold = 0</code> 时，得到 <code>(1, 1)</code> 这个点；当 <code>threshold = 1</code> 时，得到 <code>(0, 0)</code> 这个点。</li>
</ol>

<p>根据以上我们可以知道，当 ROC 曲线是 <code>y = x</code> 这条直线时，说明模型的分类是随机的。ROC 曲线越接近左上角，分类效果更好。AUC 就是 ROC 曲线和 X 轴，以及 <code>x = 1</code> 这两条直线所围的面积。一般来说，模型分类的效果要好于随机，所以 AUC 的取值通常是在 0.5 到 1 之间，值越高说明效果越好。同时，从 ROC 曲线的生成方式，我们可以看到，AUC 的值与模型预测值的绝对大小不相关，而只与相对大小有关，正样本的预测值越高，越排在前面，则 AUC 越高。如果所有负样本的预测值比正样本都低，那么 AUC 就是 1。从另外一方面来看，如果将预测值排在正样本之前的负样本看成是乱序（或者熵）的话，则 AUC 可以看成是系统熵的量度，AUC 值越高，则熵越低，系统就越有序，模型就越好。</p>

<h2 id="auc-的计算">AUC 的计算</h2>

<p>一般来说，ML 相关的库都有计算 AUC 的方法，直接调用即可。比如 <a href="https://github.com/scikit-learn/scikit-learn/blob/master/sklearn/metrics/ranking.py">scikit-learn</a>.</p>

<p>根据上面 ROC 曲线的定义，显然 AUC 可以通过积分求出。Spark 里就是通过积分计算的，代码见 <a href="https://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/mllib/evaluation/AreaUnderCurve.scala">AreaUnderCurve.scala</a>。</p>

<p>另外一种计算方法就是：统计所有的正负样本对中有多少组的正样本预测值高于负样本的预测值，再除以正样本和负样本的数量乘积。</p>

<p>考虑如下的数据，有 6 条记录，按照 score 从大到小排列如下：</p>

<table>
<thead>
<tr>
<th align="center">Index</th>
<th align="center">Class (y_true)</th>
<th align="center">Prediction (y_score)</th>
<th align="center">Rank</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0.9</td>
<td align="center">6</td>
</tr>

<tr>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0.8</td>
<td align="center">5</td>
</tr>

<tr>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">0.7</td>
<td align="center">4</td>
</tr>

<tr>
<td align="center">4</td>
<td align="center">0</td>
<td align="center">0.6</td>
<td align="center">3</td>
</tr>

<tr>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0.5</td>
<td align="center">2</td>
</tr>

<tr>
<td align="center">6</td>
<td align="center">0</td>
<td align="center">0.4</td>
<td align="center">1</td>
</tr>
</tbody>
</table>

<p>则计算 AUC 的示例代码如下：</p>

<pre><code>def auc(y_true, y_score):
    n = sum(y_true)             # positive instances (1) number
    m = len(y_true) - n         # negative instances (0) number
    a = sorted(zip(y_true, y_score), key=lambda x: x[1], reverse=True)
    n_pairs = 0.0
    mm = m
    for k, _ in a:
        if k == 0:
            mm -= 1
        else:
            n_pairs += mm
    return n_pairs / (m * n)
</code></pre>

<p>稍作转换，可以得到下面的公式。其中，<code>$n$</code> 是正样本数量，<code>$m$</code> 是负样本数量，<code>$Rank$</code> 是正样本的 Rank 值。</p>

<div>$$ AUC = \frac{\sum_{i=1}^{n}Rank_{i} - n(n+1)/2}{n\cdot m} $$</div>

		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373 0-.74-.24-1-.5L1 8a2.853 2.853 0 0 1-.7-1C.113 6.55 0 5.973 0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034 0 1.4 0h4.2c.373 0 .95.113 1.4.3.45.187.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/ml/" rel="tag">ml</a></li>
	</ul>
</div>
	</article>
	
	
<nav class="post-nav row clearfix">
	<div class="post-nav__item post-nav__item--prev col-1-2">
		<a class="post-nav__link" href="/p/2016/python-data-mining/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Python 相关的数据挖掘利器</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next col-1-2">
		<a class="post-nav__link" href="/p/2018/vps-reco/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">VPS 推荐</p></a>
	</div>
</nav>
	
<section class="comments">
	<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "m142" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

</main>

<aside class="sidebar">
	
<div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH..." value="" name="q">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="http://m.l2d.xyz/" />
	</form>
</div>
	
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/p/2018/hongkong-pcv13/">去香港打13价肺炎疫苗</a></li>
			<li class="widget__item"><a class="widget__link" href="/p/2018/bash-cmp-pitfall/">Bash 中 [ 和 [[ 整数比较的坑</a></li>
			<li class="widget__item"><a class="widget__link" href="/p/2018/vps-reco/">VPS 推荐</a></li>
			<li class="widget__item"><a class="widget__link" href="/p/2016/auc-roc/">AUC 和 ROC</a></li>
			<li class="widget__item"><a class="widget__link" href="/p/2016/python-data-mining/">Python 相关的数据挖掘利器</a></li>
		</ul>
	</div>
</div>
	
	
	
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/ad" title="Ad">Ad</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/algo" title="Algo">Algo</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/bash" title="Bash">Bash</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/c&#43;&#43;" title="C&#43;&#43;">C&#43;&#43;</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/digihome" title="Digihome">Digihome</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/go" title="Go">Go</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/map" title="Map">Map</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/misc" title="Misc">Misc</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ml" title="Ml">Ml</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mobi" title="Mobi">Mobi</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python" title="Python">Python</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/raspi" title="Raspi">Raspi</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/sec" title="Sec">Sec</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/spark" title="Spark">Spark</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/vpn" title="Vpn">Vpn</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/vps" title="Vps">Vps</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/yy" title="Yy">Yy</a>
	</div>
</div>
</aside>
	</div>
		<footer class="footer">
			<div class="container container-inner">
				<div class="footer__copyright">&copy; 2018 思考、记录. <span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span></div>
			</div>
		</footer>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$'], ['\\(','\\)']],
displayMath: [['$$','$$']],
processEscapes: true,
processEnvironments: true,
skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
TeX: { equationNumbers: { autoNumber: "AMS" },
     extensions: ["AMSmath.js", "AMSsymbols.js"] }
}
});
</script>

</body>
</html>
